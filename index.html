<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Fabric Viewer</title>

<style>
body{
margin:0;
font-family:system-ui;
background:#0b1220;
color:#fff;
display:flex;
flex-direction:column;
height:100vh;
}

/* header */
header{
background:#111827;
padding:14px;
text-align:center;
font-weight:700;
}

/* chat area */
#chat{
flex:1;
overflow-y:auto;
padding:14px;
padding-bottom:90px;
display:flex;
flex-direction:column;
gap:12px;
}

/* bubbles */
.user{
align-self:flex-end;
background:#2563eb;
padding:10px 14px;
border-radius:14px;
max-width:80%;
}

.bot{
align-self:flex-start;
background:#1f2937;
padding:12px;
border-radius:14px;
max-width:85%;
white-space:pre-wrap;
}

/* fabric image */
.card img{
width:220px;
height:345px;
object-fit:cover;
border-radius:0;
margin:14px auto;
display:block;
box-shadow:0 10px 22px rgba(0,0,0,.6);
cursor:pointer;
}

/* bottom input bar */
footer{
position:fixed;
bottom:0;
left:0;
width:100%;
display:flex;
padding:10px;
background:#111827;
box-shadow:0 -4px 12px rgba(0,0,0,.4);
z-index:5;
}

input{
flex:1;
padding:12px;
border-radius:10px;
border:none;
background:#1f2937;
color:#fff;
font-size:16px;
}

button{
margin-left:8px;
padding:12px 18px;
border:none;
border-radius:10px;
background:#22c55e;
font-weight:bold;
}

/* fullscreen viewer */
#viewer{
position:fixed;
inset:0;
background:rgba(0,0,0,.9);
display:none;
align-items:center;
justify-content:center;
z-index:20;
}

#viewer img{
max-width:95%;
max-height:95%;
}
</style>
</head>

<body>

<header>üè≠ Fabric Viewer</header>

<div id="chat"></div>

<footer>
<input id="q" placeholder="Enter Sill Number">
<button onclick="send()">Send</button>
</footer>

<div id="viewer" onclick="this.style.display='none'">
<img id="full">
</div>

<script>
const chat=document.getElementById("chat");

function addUser(t){
const d=document.createElement("div");
d.className="user";
d.textContent=t;
chat.appendChild(d);
}

function addBot(text){

const wrap=document.createElement("div");
wrap.className="bot";

const imgMatch=text.match(/IMAGE:(\/img\/\S+)/);
const clean=text.replace(/IMAGE:(\/img\/\S+)/,"");

wrap.textContent=clean;

if(imgMatch){
const img=document.createElement("img");
img.src=imgMatch[1];

img.onclick=()=>{
document.getElementById("viewer").style.display="flex";
document.getElementById("full").src=img.src;
};

const card=document.createElement("div");
card.className="card";
card.appendChild(img);
wrap.appendChild(card);
}

chat.appendChild(wrap);
chat.scrollTop=chat.scrollHeight;
}

async function send(){
const q=document.getElementById("q");
if(!q.value) return;

addUser(q.value);

const r=await fetch("/ask",{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({question:q.value})
});

const j=await r.json();
addBot(j.reply);

q.value="";
}

document.getElementById("q").addEventListener("keypress",e=>{
if(e.key==="Enter")send();
});
</script>

</body>
</html>
